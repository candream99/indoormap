<!DOCTYPE html>
<html>
<head>
    <title>교보빌딩 1층 실내 지도 (Styled Map 적용 v6.0)</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        let historicalOverlay = null; 
        let isOverlayVisible = false;

        // 1. 라벨이 없는 깨끗한 지도 스타일 정의 (지도 타일 자체를 수정)
        const CLEAN_MAP_STYLE = [
            {
                featureType: "all",
                elementType: "labels",
                stylers: [{ visibility: "off" }] // 모든 라벨 숨김
            },
            {
                featureType: "all",
                elementType: "geometry",
                stylers: [{ saturation: -100 }] // 모든 지형지물을 흑백으로 처리
            }
        ];

        // 2. 기본 지도를 위한 스타일 (라벨을 다시 보이게 함)
        const DEFAULT_MAP_STYLE = null;

        function initMap() {
            // 경계 및 중심 좌표 설정
            const imageBounds = {
                north: 37.571352, south: 37.570529,
                east: 126.978045, west: 126.977640
            };
            const kyoboCenter = {  
                lat: (imageBounds.north + imageBounds.south) / 2,  
                lng: (imageBounds.east + imageBounds.west) / 2  
            };

            // 3. 지도 생성 (초기에는 기본 지도 유형 사용)
            const map = new google.maps.Map(document.getElementById('map'), {
                zoom: 18,
                center: kyoboCenter,
                mapTypeId: 'roadmap' 
            });

            // 4. 깨끗한 스타일의 새로운 지도 유형을 정의하고 추가합니다.
            const cleanMapType = new google.maps.StyledMapType(CLEAN_MAP_STYLE, {
                name: "Clean Map"
            });
            map.mapTypes.set('clean_map', cleanMapType); // 'clean_map'이라는 새 유형 추가
            
            // 5. Rectangle 생성 및 이벤트 리스너 설정 (mouseover/mouseout은 동일)
            const rectangle = new google.maps.Rectangle({
                strokeColor: '#FF0000', strokeOpacity: 1.0, strokeWeight: 2,
                fillColor: '#FF0000', fillOpacity: 0.0, 
                bounds: imageBounds, editable: false, zIndex: 10, map: map
            });

            google.maps.event.addListener(rectangle, 'mouseover', function() {
                if (!isOverlayVisible) { rectangle.setOptions({ fillOpacity: 0.2 }); }
            });
            google.maps.event.addListener(rectangle, 'mouseout', function() {
                if (!isOverlayVisible) { rectangle.setOptions({ fillOpacity: 0.0 }); }
            });

            // C. 영역을 클릭했을 때 (click) : 이미지 토글 및 지도 유형 변경 (⭐ 최종 수정)
            google.maps.event.addListener(rectangle, 'click', function() {
                if (!isOverlayVisible) {
                    // 1. Ground Overlay 생성/표시
                    if (historicalOverlay === null) {
                        historicalOverlay = new google.maps.GroundOverlay(
                            '1F_2.png', imageBounds, { opacity: 0.8 }
                        );
                    }
                    historicalOverlay.setMap(map);
                    isOverlayVisible = true;
                    
                    // 2. 지도 유형을 라벨이 없는 'clean_map'으로 변경하여 모든 글자를 제거합니다. ⭐
                    map.setMapTypeId('clean_map'); 

                    // 3. 사각형 스타일 변경
                    rectangle.setOptions({ fillOpacity: 0.0, strokeWeight: 4 });
                } else {
                    // 1. 이미지 숨김
                    historicalOverlay.setMap(null);
                    isOverlayVisible = false;

                    // 2. 지도 유형을 원래의 'roadmap'으로 복원합니다. ⭐
                    map.setMapTypeId('roadmap');

                    // 3. 사각형 스타일 복원
                    rectangle.setOptions({ strokeWeight: 2, fillOpacity: 0.0 });
                }
            });
        }
    </script>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBFx8u1rY7G06Ho4y-nYPLQ4RKy4zsW_og&callback=initMap">
    </script>
</body>
</html>

