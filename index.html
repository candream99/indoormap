<!DOCTYPE html>
<html>
<head>
    <title>교보빌딩 1층 실내 지도 (동적 표시)</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script>
        function initMap() {
            // 1. 이미지 경계 좌표 설정 (이전 코드와 동일)
            const imageBounds = {
                north: 37.571352,
                south: 37.570529,
                east: 126.978045,
                west: 126.977640
            };

            const kyoboCenter = {  
                lat: (imageBounds.north + imageBounds.south) / 2,  
                lng: (imageBounds.east + imageBounds.west) / 2  
            };

            // 2. 지도 생성
            const map = new google.maps.Map(document.getElementById('map'), {
                zoom: 18,
                center: kyoboCenter,
                mapTypeId: 'roadmap'
            });

            // 3. Ground Overlay 객체 생성 (초기에는 지도에 표시하지 않음)
            const image_url = '1F_2.jpg';
            const historicalOverlay = new google.maps.GroundOverlay(
                image_url,
                imageBounds,
                {
                    opacity: 0.8 // 이미지 투명도
                }
            );

            // 이미지 표시 여부를 추적하는 변수
            let isOverlayVisible = false;

            // 4. 영역 표시 및 클릭 이벤트 처리를 위한 Rectangle 생성
            const rectangle = new google.maps.Rectangle({
                // 초기 스타일: 테두리만 표시
                strokeColor: '#FF0000',
                strokeOpacity: 1.0,
                strokeWeight: 2,
                fillColor: '#FF0000',
                fillOpacity: 0.0, // 평소에는 투명 (0.0)
                bounds: imageBounds,
                editable: false, // 이제 조정용이 아니므로 편집 불가능하게 설정
                map: map
            });

            // 5. 이벤트 리스너 설정
            
            // A. 마우스를 올렸을 때 (mouseover) : 반투명하게 채우기
            google.maps.event.addListener(rectangle, 'mouseover', function() {
                if (!isOverlayVisible) {
                    rectangle.setOptions({
                        fillOpacity: 0.2 // 반투명 빨간색 (0.2)
                    });
                }
            });

            // B. 마우스가 벗어났을 때 (mouseout) : 채우기 제거
            google.maps.event.addListener(rectangle, 'mouseout', function() {
                if (!isOverlayVisible) {
                    rectangle.setOptions({
                        fillOpacity: 0.0 // 다시 투명하게
                    });
                }
            });

            // C. 영역을 클릭했을 때 (click) : 이미지 토글 (표시/숨김)
            google.maps.event.addListener(rectangle, 'click', function() {
                if (!isOverlayVisible) {
                    // 이미지 표시
                    historicalOverlay.setMap(map);
                    // 사각형을 채우는 색상 제거 (이미지가 보이므로)
                    rectangle.setOptions({
                        fillOpacity: 0.0,
                        strokeWeight: 4 // 클릭되었다는 것을 강조
                    });
                    isOverlayVisible = true;
                } else {
                    // 이미지 숨김
                    historicalOverlay.setMap(null);
                    // 사각형을 원래 상태로 복원
                    rectangle.setOptions({
                        fillOpacity: 0.0,
                        strokeWeight: 2
                    });
                    isOverlayVisible = false;
                }
            });
        }
    </script>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBFx8u1rY7G06Ho4y-nYPLQ4RKy4zsW_og&callback=initMap">
        </script>
</body>
</html>
